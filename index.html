<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Giám sát nhiệt độ từ ESP32</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <h2>Biểu đồ nhiệt độ từ ESP32</h2>
  <canvas id="tempChart" width="600" height="300"></canvas>

  <script>
    const ctx = document.getElementById('tempChart').getContext('2d');

    const tempData = {
      labels: [],
      datasets: [{
        label: 'Nhiệt độ (°C)',
        data: [],
        borderColor: 'red',
        backgroundColor: 'rgba(255, 0, 0, 0.3)',
        fill: false,
        tension: 0.1
      }]
    };

    const tempChart = new Chart(ctx, {
      type: 'line',
      data: tempData,
      options: {
        scales: {
          y: {
            suggestedMin: 20,
            suggestedMax: 40,
            title: {
              display: true,
              text: 'Nhiệt độ (°C)'
            }
          },
          x: {
            title: {
              display: true,
              text: 'Thời gian'
            }
          }
        }
      }
    });

    function fetchTemp() {
      fetch("http://192.168.68.101/temperature")
        .then(res => res.json())
        .then(data => {
          const now = new Date();
          const timeStr = now.toLocaleTimeString();

          // Thêm dữ liệu mới
          tempChart.data.labels.push(timeStr);
          tempChart.data.datasets[0].data.push(data.temperature);

          // Giữ chỉ 10 điểm gần nhất
          if (tempChart.data.labels.length > 10) {
            tempChart.data.labels.shift();
            tempChart.data.datasets[0].data.shift();
          }

          tempChart.update();
        })
        .catch(err => {
          console.error("Lỗi lấy nhiệt độ từ ESP32:", err);
        });
    }

    setInterval(fetchTemp, 2000); // gọi mỗi 2 giây
  </script>
</body>
</html>
