<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>HiveMQ Cloud Data</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 2em;
      background-color: #f9f9f9;
    }

    h1 {
      color: #333;
    }

    #data {
      font-size: 2em;
      margin-top: 20px;
      color: green;
    }
  </style>
</head>
<body>
  <h1>Nhận dữ liệu từ ESP32:</h1>
  <div id="data">Chờ dữ liệu...</div>

  <!-- MQTT.js từ CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mqtt.js/4.3.7/mqtt.min.js"></script> 

  <script>
    const clientId = 'web_' + Math.random().toString(16).substr(2, 8);
    const host = 'wss://534e94203b374c449f2f7d6b7faf3bcf.s1.eu.hivemq.cloud:8000/mqtt';

    const options = {
      clientId: clientId,
      clean: true,
      connectTimeout: 4000,
      username: 'thanh',
      password: 'thanh317@T',
      will: {
        topic: '/esp32/status',
        payload: 'Web disconnected',
        qos: 0,
        retain: false
      }
    };

    const client = mqtt.connect(host, options);

    client.on('connect', () => {
      console.log('Connected to HiveMQ Cloud');
      client.subscribe('/esp32/test', (err) => {
        if (!err) {
          document.getElementById("data").innerText = "Đang chờ dữ liệu...";
        } else {
          console.error('Failed to subscribe:', err);
        }
      });
    });

    client.on('message', (topic, message) => {
      if (topic === '/esp32/test') {
        const receivedData = message.toString();
        document.getElementById("data").innerText = receivedData;
        console.log('Received:', receivedData); // Log để debug
      }
    });

    client.on('error', (error) => {
      console.error('MQTT Error:', error);
    });

    client.on('reconnect', () => {
      console.log('Reconnecting...');
    });

    client.on('close', () => {
      console.log('Connection closed');
    });
  </script>
</body>
</html>
