<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Nhận dữ liệu từ ESP32</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 40px;
      background-color: #f9f9f9;
    }
    #log {
      white-space: pre-wrap;
      background-color: #000;
      color: #0f0;
      padding: 20px;
      height: 300px;
      overflow-y: scroll;
      font-size: 16px;
      border-radius: 8px;
    }
  </style>
  <!-- Thư viện MQTT.js -->
  <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script> 
</head>
<body>

  <h1>Terminal Web - Nhận dữ liệu từ ESP32</h1>
  <div id="log">[INFO] Đang chờ dữ liệu...\n</div>

  <script>
    const brokerUrl = 'wss://5e4834b4d1744446a84305990afbfb9e.s1.eu.hivemq.cloud:8884/mqtt';
    const topic = 'esp32/hello';

    const client = mqtt.connect(brokerUrl);

    function appendLog(text) {
      const logDiv = document.getElementById("log");
      logDiv.innerText += text + "\n";
      logDiv.scrollTop = logDiv.scrollHeight;
    }

    client.on('connect', () => {
      appendLog("[INFO] Kết nối MQTT thành công");
      client.subscribe(topic, (err) => {
        if (!err) {
          appendLog("[INFO] Đang lắng nghe topic: " + topic);
        } else {
          appendLog("[ERROR] Không thể đăng ký topic");
        }
      });
    });

    client.on('message', (receivedTopic, message) => {
      if (receivedTopic === topic) {
        const receivedData = message.toString();
        appendLog(`[DATA] ${receivedData}`);
      }
    });

    client.on('error', (err) => {
      appendLog("[ERROR] Lỗi kết nối MQTT: " + err.message);
    });
  </script>

</body>
</html>
